#include "analyse_frequence.h"
//                             a                  b                  c                  d                  e                  f                  g                  h                  i                  j                  k                  l                  m                  n                  o                  p                  q                  r                  s                  t                  u                  v                  w                  x                  y                  z
double FREQUENCETHEORIQUE[] = {0.088406909629580, 0.010537060627311, 0.031581720934285, 0.035203757723125, 0.171919567463495, 0.011068602513724, 0.009395552641734, 0.009726262152641, 0.075092636007917, 0.005394672962734, 0.000062656381615, 0.059659663813242, 0.028249314306817, 0.067354780349963, 0.051662468827413, 0.026124391589937, 0.011992265463885, 0.064085859989958, 0.075001763507430, 0.076678132922816, 0.063792910285190, 0.018107279343726, 0.000107885160396, 0.003998804964377, 0.003268090474155, 0.001526989962531};
double FREQUENCECOUPLETHEORIQUE[26][26] = {
                              { 0.000431069378434, 0.002377451468667, 0.003639717554188, 0.002227403720421, 0.000549327349508, 0.001146551296620, 0.001784890022206, 0.000296280723230, 0.019254008373003, 0.000431069378434, 0.000006357955434, 0.005303382559450, 0.002895412904700, 0.012844341568016, 0.000092402285643, 0.003744835750699, 0.000622655768848, 0.008694292124316, 0.005460212126825, 0.004304759692597, 0.006234187235006, 0.005753101940490, 0.000008477273912, 0.000008477273912, 0.000498039842340, 0.000046625006517},
                              { 0.001805235479595, 0.000025431821736, 0.000008901137608, 0.000008901137608, 0.001345767233556, 0.000001271591087, 0.000000000000000, 0.000001695454782, 0.001184699029225, 0.000028398867606, 0.000000000000000, 0.002341846918235, 0.000003390909565, 0.000004238636956, 0.001783194567424, 0.000000423863696, 0.000001695454782, 0.001621278635701, 0.000289922767796, 0.000009325001303, 0.000270848901494, 0.000002543182174, 0.000000000000000, 0.000000000000000, 0.000020345457389, 0.000000000000000},
                              { 0.002473668527570, 0.000020769321085, 0.000552294395378, 0.000152590930419, 0.009804815006809, 0.000014411365651, 0.000008477273912, 0.005353822339227, 0.001750133199166, 0.000014411365651, 0.000019073866302, 0.001004556958591, 0.000041538642170, 0.000020345457389, 0.006904315737762, 0.000072480691949, 0.000074600010427, 0.001442408156155, 0.000307725043012, 0.000798983066221, 0.001199110394876, 0.000027127276519, 0.000000000000000, 0.000000000000000, 0.000073752283036, 0.000001695454782},
                              { 0.004545090408007, 0.000028822731301, 0.000093673876729, 0.000224647758672, 0.018970443560642, 0.000025855685432, 0.000018226138911, 0.000217865939543, 0.004268731278470, 0.000042386369561, 0.000000000000000, 0.000158525022157, 0.000126311381291, 0.000033061368257, 0.001868391170241, 0.000113171606727, 0.000064003418037, 0.001291936544214, 0.000435308015390, 0.000044081824343, 0.003157360668586, 0.000034756823040, 0.000000847727391, 0.000000423863696, 0.000028398867606, 0.000000847727391},
                              { 0.005976478108076, 0.001781922976337, 0.008801105775609, 0.008074179537641, 0.006832258909509, 0.002979337916430, 0.001843383212200, 0.000743880785792, 0.003064958382943, 0.001380524056596, 0.000010172728695, 0.012993117725174, 0.008837558053431, 0.019966947109016, 0.001094416062060, 0.006407547486509, 0.003071740202073, 0.014472825886543, 0.026759786694834, 0.018115086622904, 0.008992268302328, 0.004396314250848, 0.000036452277822, 0.000642577362542, 0.000164459113896, 0.001261842221826},
                              { 0.003201442492929, 0.000002967045869, 0.000016106820433, 0.000047048870213, 0.001451309293763, 0.001016001278373, 0.000001695454782, 0.000007629546521, 0.001556003626578, 0.000002967045869, 0.000000000000000, 0.000434884151694, 0.000008477273912, 0.000003814773260, 0.001687401372216, 0.000010596592390, 0.000012292047173, 0.001043552418587, 0.000058493189994, 0.000004238636956, 0.000695984188189, 0.000004238636956, 0.000000000000000, 0.000000423863696, 0.000000423863696, 0.000000000000000},
                              { 0.001392816103769, 0.000000423863696, 0.000016954547824, 0.000042386369561, 0.002874219719919, 0.000004238636956, 0.000006781819130, 0.000006781819130, 0.000623079632544, 0.000001271591087, 0.000000000000000, 0.000489986432123, 0.000052559098255, 0.000986754683376, 0.000547208031030, 0.000005086364347, 0.000008901137608, 0.001375861555944, 0.000056373871516, 0.000225919349759, 0.000844760345347, 0.000002119318478, 0.000000847727391, 0.000000000000000, 0.000008477273912, 0.000002967045869},
                              { 0.002758928794714, 0.000072480691949, 0.000039419323692, 0.000014411365651, 0.003749498251350, 0.000003390909565, 0.000000423863696, 0.000000000000000, 0.000679877367756, 0.000011868183477, 0.000000000000000, 0.000028822731301, 0.000027551140215, 0.000007629546521, 0.001930275269800, 0.000009325001303, 0.000008901137608, 0.000055526144125, 0.000010172728695, 0.000014411365651, 0.000428950059956, 0.000014411365651, 0.000000423863696, 0.000000000000000, 0.000052135234560, 0.000000000000000},
                              { 0.001411466106375, 0.000701918279927, 0.001723005922647, 0.001678924098304, 0.010332949171537, 0.000695984188189, 0.001325845639863, 0.000036028414127, 0.000291194358883, 0.000195825027371, 0.000002967045869, 0.010444849187178, 0.001535658169189, 0.008026282940037, 0.002315143505412, 0.000672247821235, 0.000965985362291, 0.004771009757766, 0.009252096747736, 0.016686665968704, 0.000687083050581, 0.001430539972678, 0.000000847727391, 0.000585779627331, 0.000012715910868, 0.000082229556948},
                              { 0.001034651280980, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.002701283332111, 0.000000000000000, 0.000000000000000, 0.000000847727391, 0.000006781819130, 0.000000423863696, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000423863696, 0.001307195637256, 0.000000000000000, 0.000000000000000, 0.000000423863696, 0.000000000000000, 0.000000000000000, 0.000442513698215, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000016106820433, 0.000000000000000},
                              { 0.000004662500652, 0.000000000000000, 0.000001695454782, 0.000002119318478, 0.000020769321085, 0.000000000000000, 0.000000000000000, 0.000002119318478, 0.000009325001303, 0.000000847727391, 0.000000000000000, 0.000003814773260, 0.000001695454782, 0.000000423863696, 0.000006781819130, 0.000000000000000, 0.000000000000000, 0.000000847727391, 0.000003390909565, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000003390909565, 0.000000847727391},
                              { 0.014366436098945, 0.000090282967165, 0.000314506862141, 0.000472184156908, 0.022690695216995, 0.000378934143874, 0.000058069326298, 0.000677334185582, 0.003359967515086, 0.000525590982554, 0.000000847727391, 0.006262586102611, 0.000241602306497, 0.000640881907760, 0.002728410608630, 0.000359436413876, 0.000702342143623, 0.000338667092791, 0.001396207013333, 0.000334428455835, 0.003565541407456, 0.000215322757369, 0.000001695454782, 0.000000423863696, 0.000609939857980, 0.000002543182174},
                              { 0.005592033736159, 0.001493695663323, 0.000015682956738, 0.000070361373471, 0.010147720736556, 0.000020345457389, 0.000053830689342, 0.000003814773260, 0.002354986692799, 0.000004662500652, 0.000000000000000, 0.000094521604121, 0.003018757240122, 0.000082653420644, 0.003340469785088, 0.001744622971123, 0.000006781819130, 0.000025855685432, 0.000056373871516, 0.000025855685432, 0.000512451207990, 0.000003814773260, 0.000002543182174, 0.000000000000000, 0.000129702290856, 0.000000423863696},
                              { 0.004425136982150, 0.000369609142570, 0.004144539215657, 0.005603054192245, 0.011253581118398, 0.001239377445958, 0.001780651385250, 0.000368337551484, 0.002087528700870, 0.000414114830609, 0.000006781819130, 0.000872311485562, 0.000695136460797, 0.002381690105623, 0.002606761727991, 0.001258027448565, 0.000839250117304, 0.000510331889512, 0.007799939726582, 0.015668121508158, 0.001162234253358, 0.001334746777470, 0.000002543182174, 0.000021193184780, 0.000308996634098, 0.000070785237167},
                              { 0.000025855685432, 0.000509060298425, 0.000997351275766, 0.000268305719320, 0.000402670510828, 0.000295432995839, 0.000273815947363, 0.000078838647383, 0.005767089442445, 0.000016530684129, 0.000001695454782, 0.001818799117855, 0.004466251760624, 0.013944691721815, 0.000052982961951, 0.000548479622117, 0.000153862521506, 0.004181415357175, 0.002040055966962, 0.001403412696159, 0.014694506599346, 0.000083501148035, 0.000009325001303, 0.000009325001303, 0.000698527370362, 0.000002543182174},
                              { 0.006218504278268, 0.000014411365651, 0.000024584094345, 0.000158101158462, 0.004792202942547, 0.000005934091739, 0.000004238636956, 0.000361555732354, 0.001335594504862, 0.000009325001303, 0.000000000000000, 0.002605490136904, 0.000029246594997, 0.000009748864999, 0.004363252882591, 0.000964713771204, 0.000006781819130, 0.003797818712650, 0.000506517116252, 0.000368337551484, 0.001056692193151, 0.000008901137608, 0.000000000000000, 0.000000000000000, 0.000012715910868, 0.000000000000000},
                              { 0.000020345457389, 0.000002967045869, 0.000021193184780, 0.000001695454782, 0.000002543182174, 0.000016954547824, 0.000001271591087, 0.000009748864999, 0.000000423863696, 0.000000423863696, 0.000000000000000, 0.000007205682825, 0.000011020456086, 0.000000847727391, 0.000006781819130, 0.000003390909565, 0.000000847727391, 0.000000000000000, 0.000005934091739, 0.000000423863696, 0.012123349421786, 0.000000423863696, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000000000000},
                              { 0.007379466940539, 0.000452262563214, 0.001835329801984, 0.003585463001150, 0.020736683580241, 0.000308572770403, 0.000759563742530, 0.000058917053690, 0.006298190653043, 0.000175903433677, 0.000002543182174, 0.002741974246890, 0.001559394536143, 0.000939705813163, 0.004672249516689, 0.000647663726889, 0.000656141000802, 0.002291831002154, 0.003151426576847, 0.003495603897681, 0.001857370714155, 0.000570520534289, 0.000004662500652, 0.000000000000000, 0.000075871601514, 0.000011020456086},
                              { 0.008077146583510, 0.000764650106877, 0.003130657255762, 0.004765499529723, 0.013390701871655, 0.000982092182724, 0.000483204612993, 0.000440394379737, 0.004875704090581, 0.000529405755815, 0.000005086364347, 0.004210661952172, 0.001445375202024, 0.000818904659915, 0.005792945127878, 0.003175162943801, 0.002090919610435, 0.000860019438389, 0.006619479334314, 0.005793368991573, 0.003359543651391, 0.000863410347954, 0.000011868183477, 0.000038147732605, 0.000360708004963, 0.000001695454782},
                              { 0.009402992223373, 0.000542545530379, 0.002331674189541, 0.004816363173196, 0.016107668160504, 0.000733708057098, 0.000293313677361, 0.000842217163174, 0.006325317929561, 0.000574759171245, 0.000000000000000, 0.004230159682170, 0.001072799013584, 0.000498039842340, 0.004504399493229, 0.002981881098604, 0.001660697959393, 0.006794535040600, 0.003760942571132, 0.004006359650889, 0.002813607211447, 0.000684963732103, 0.000008901137608, 0.000000000000000, 0.000098760241077, 0.000027975003910},
                              { 0.001823037754811, 0.000805764885351, 0.001733602515038, 0.001394087694855, 0.008748122813658, 0.000589170536895, 0.000470064838430, 0.000075871601514, 0.007666846526162, 0.000476846657559, 0.000001271591087, 0.002124404842388, 0.001190209257268, 0.006964928246234, 0.000709547826448, 0.001666208187436, 0.000236939805845, 0.009848896831153, 0.006874645279070, 0.005835331497438, 0.000365794369310, 0.001983682095446, 0.000001271591087, 0.002768253796017, 0.000097488649990, 0.000038147732605},
                              { 0.004959205238616, 0.000000423863696, 0.000001695454782, 0.000000000000000, 0.005683588294411, 0.000000000000000, 0.000000423863696, 0.000000000000000, 0.002740278792107, 0.000000000000000, 0.000000000000000, 0.000003814773260, 0.000001271591087, 0.000000423863696, 0.003788917575042, 0.000000847727391, 0.000000423863696, 0.001039737645327, 0.000000000000000, 0.000000000000000, 0.000237787533236, 0.000000423863696, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000000000000},
                              { 0.000058493189994, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000034756823040, 0.000000000000000, 0.000000000000000, 0.000001271591087, 0.000005934091739, 0.000000000000000, 0.000000000000000, 0.000000423863696, 0.000000423863696, 0.000002119318478, 0.000001271591087, 0.000000000000000, 0.000000423863696, 0.000000000000000, 0.000000423863696, 0.000000847727391, 0.000002119318478, 0.000000000000000, 0.000000000000000, 0.000000000000000, 0.000000423863696, 0.000000000000000},
                              { 0.000305181860838, 0.000116562516292, 0.000325527318227, 0.000307301179316, 0.000409876193653, 0.000113171606727, 0.000056797735212, 0.000105542060206, 0.000252198898887, 0.000045777279126, 0.000000000000000, 0.000143689792811, 0.000165306841287, 0.000060612508472, 0.000084772739122, 0.000380205734961, 0.000197520482153, 0.000078838647383, 0.000164882977592, 0.000230581850411, 0.000026703412823, 0.000095369331512, 0.000000000000000, 0.000003390909565, 0.000022888639563, 0.000000000000000},
                              { 0.001315672911168, 0.000012292047173, 0.000053406825647, 0.000047048870213, 0.000806188749047, 0.000043234096952, 0.000025007958041, 0.000002119318478, 0.000017802275216, 0.000011868183477, 0.000000000000000, 0.000065275009124, 0.000066122736515, 0.000026703412823, 0.000128006836074, 0.000086044330208, 0.000009325001303, 0.000183532980198, 0.000260252309103, 0.000048320461299, 0.000002119318478, 0.000035180686735, 0.000000423863696, 0.000003390909565, 0.000000847727391, 0.000000423863696},
                              { 0.000102575014337, 0.000031365913475, 0.000060612508472, 0.000125463653900, 0.000206421619761, 0.000011868183477, 0.000010172728695, 0.000008901137608, 0.000040267051083, 0.000025431821736, 0.000000000000000, 0.000154286385201, 0.000094945467816, 0.000015259093042, 0.000051711370864, 0.000119529562162, 0.000025007958041, 0.000027127276519, 0.000036028414127, 0.000026703412823, 0.000040690914778, 0.000235668214758, 0.000000423863696, 0.000000000000000, 0.000005510228043, 0.000003390909565}
};

// double somme = 0;
// for (int i = 0; i < 26; i++) {somme += FREQUENCETHEORIQUE[i];}
// printf("si OK  %lf a peu près egal a 1", somme);

void enleverAccentsEspacePonctuationMajuscule(char* str) {
    unsigned char* src = (unsigned char*)str;
    unsigned char* dst = src;

    while (*src) {
        if (*src == 0xC3) { // Détecter un caractère accentué UTF-8
            src++;
            switch (*src) {
                case 0xA0: case 0xA1: case 0xA2: case 0xA3: case 0xA4: case 0xA5: // à á â ã ä å
                    *dst = 'a'; break;
                case 0xA8: case 0xA9: case 0xAA: case 0xAB: // è é ê ë
                    *dst = 'e'; break;
                case 0xAC: case 0xAD: case 0xAE: case 0xAF: // ì í î ï
                    *dst = 'i'; break;
                case 0xB2: case 0xB3: case 0xB4: case 0xB5: case 0xB6: // ò ó ô õ ö
                    *dst = 'o'; break;
                case 0xB9: case 0xBA: case 0xBB: case 0xBC: // ù ú û ü
                    *dst = 'u'; break;
                case 0xBD: case 0xBF: // ý ÿ
                    *dst = 'y'; break;
                case 0xA7: // ç
                    *dst = 'c'; break;
                case 0xB1: // ñ
                    *dst = 'n'; break;
                default:
                    src++; // Ignorer caractères inconnus
                    continue;
            }
        } else if ((*src >= 'a' && *src <= 'z') || (*src >= 'A' && *src <= 'Z')) {
            // Convertir en minuscule si majuscule
            *dst = (*src >= 'A' && *src <= 'Z') ? (*src + 32) : *src;
        } else if (*src == '\0') {
            // conserver le symbole fin de chaine
            *dst = '\0';
        } else {
            // Ignorer les espaces, chiffres et caractères de ponctuation
            src++;
            continue;
        }
        src++;
        dst++;
    }
    *dst = '\0'; // Terminer la chaîne
}

// TEST - OK
// char test[TAILLE_MAX_TEXTE] = "test  éçèè - A";
// enleverAccentsEspacePonctuationMajuscule(test);
// printf("%s",test);

void freqSimpleFichier(char* nomFichier, double tabfreq[26]) {
    FILE* fichier = fopen(nomFichier, "r");
    assert(fichier != NULL);
    int tab[26] = {0};
    char ligne[TAILLE_MAX_TEXTE];
    int nb_char = 0;
    while(fscanf(fichier, "%[^\n]\n", ligne) != EOF) {
        enleverAccentsEspacePonctuationMajuscule(ligne);
        for (int i = 0; ligne[i] != '\0' ; i++) {
            if (ligne[i] >= 'a' && ligne[i] <= 'z') {
                tab[ligne[i] - 'a'] += 1;
                nb_char ++;
            }
            if (ligne[i] >= 'A' && ligne[i] <= 'Z') {
                tab[ligne[i] - 'A'] += 1;
                nb_char ++;
            }
        }
    }
    fclose(fichier);
    for (int i = 0; i < 26; i ++) tabfreq[i] = (double)tab[i]/nb_char;
}


// TEST
// double tab[26];
// freqSimpleFichier(FICHIERPOURANALYSE, tab);
// for (int i = 0; i < 26; i ++) {
//     printf("Fréquence de %c : %lf\n", i + 'a', tab[i]);
// }

void freqSimpleTexte(char* texte, double tabfreq[26]) {
    int tab[26] = {0};
    int nb_char = 0;
    enleverAccentsEspacePonctuationMajuscule(texte);
    int taille = strlen(texte);
    for (int i = 0; texte[i] != '\0' ; i++) {
        if (texte[i] >= 'a' && texte[i] <= 'z') {
            tab[texte[i] - 'a'] += 1;
            nb_char ++;
        }
        if (texte[i] >= 'A' && texte[i] <= 'Z') {
            tab[texte[i] - 'A'] += 1;
            nb_char ++;
        }
    }
    for (int i = 0; i < 26; i ++) tabfreq[i] = (double)tab[i]/taille;
}

// TEST - OK
// char test[TAILLE_MAX_TEXTE] = "test  2 é 5 t tot 12car";
// double tab[26] = {0}; 
// freqSimpleTexte(test, tab);
// for (int i = 0; i < 26; i ++) {
//     printf("Fréquence de %c : %lf\n", i + 'a', tab[i]);
// }

void freqCoupleFichier(char* nomFichier, double tabfreq[26][26]) {
    FILE* fichier = fopen(nomFichier, "r");
    assert(fichier != NULL);
    int tab[26][26] = {0};
    char ligne[TAILLE_MAX_TEXTE];
    int nb_couple = 0;
    while(fscanf(fichier, "%[^\n]\n", ligne) != EOF) {
        enleverAccentsEspacePonctuationMajuscule(ligne);
        int premiere_lettre = 0;
        int deuxieme_lettre = 0;
        for (int i = 0; ligne[i+1] != '\0'; i++) {
            premiere_lettre = ligne[i] - 'a';
            deuxieme_lettre = ligne[i+1] - 'a';
            nb_couple ++;
            tab[premiere_lettre][deuxieme_lettre] += 1;
        }
    }
    fclose(fichier);
    for (int i = 0; i < 26; i++) {
        for (int j = 0; j < 26; j++) {
            tabfreq[i][j] = (double)tab[i][j]/nb_couple;
        }
    }
}

//TEST
// double tab[26][26];
// freqCoupleFichier(FICHIERPOURANALYSE, tab);
// for (int i = 0; i < 26; i ++) {
//     for (int j = 0; j < 26; j ++) {
//         printf("Fréquence de %c%c : %lf\n", i + 'a', j + 'a', tab[i][j]);
//     }
// }

void freqCoupleTexte(char* texte, double tabfreq[26][26]) {
    int tab[26][26] = {0};
    int nb_couple = 0;
    enleverAccentsEspacePonctuationMajuscule(texte);
    int premiere_lettre = 0;
    int deuxieme_lettre = 0;
    for (int i = 0; texte[i+1] != '\0'; i++) {
        premiere_lettre = texte[i] - 'a';
        deuxieme_lettre = texte[i+1] - 'a';
        nb_couple ++;
        tab[premiere_lettre][deuxieme_lettre] += 1;
    }
    for (int i = 0; i < 26; i++) {
        for (int j = 0; j < 26; j++) {
            tabfreq[i][j] = (double)tab[i][j]/nb_couple;
        }
    }
}

// int main(int argc, char const *argv[])
// {

// }